# FedMozi - 联邦学习实验框架

FedMozi 是一个用于联邦学习实验的Python框架，支持多种攻击和防御方法的研究。

## 项目结构

### 核心文件

#### `src/main.py`
- **作用**: 项目的主入口文件
- **功能**: 
  - 使用 Typer 提供命令行接口
  - 加载 TOML 配置文件
  - 支持命令行参数覆盖配置文件参数
  - 设置日志记录系统
  - 启动联邦学习实验

#### `batch_runner.py`
- **作用**: 批量实验运行器
- **功能**:
  - 支持单个配置文件运行或批量运行所有配置
  - 使用 tmux 会话管理多个并行实验
  - 自动清理旧日志文件
  - 支持所有 main.py 的命令行参数

#### `batch.sh`
- **作用**: Shell脚本版本的批量运行器
- **功能**:
  - 遍历 `conf/` 目录下的所有 TOML 配置文件
  - 为每个配置创建独立的 tmux 会话
  - 支持 `--method` 参数覆盖
  - 自动清理旧日志和会话

#### `process_logs.py`
- **作用**: 实验结果处理和分析工具
- **功能**:
  - 读取 Parquet 格式的实验日志
  - 计算 Top-5 准确率的均值和标准差
  - 支持多种输出格式（LaTeX、Markdown、CSV、Excel）
  - 生成实验结果对比表格

#### `logger.py`
- **作用**: 日志系统配置工具
- **功能**: 显示 loguru 日志级别信息

### 配置文件

#### `conf/` 目录
- **作用**: 存储实验配置文件


#### 配置参数说明
- **任务参数**: 模型架构、数据集、数据分割策略
- **系统参数**: 客户端数量、服务器数量、训练轮数
- **训练参数**: 学习率、批次大小、设备配置
- **安全参数**: 攻击类型、聚合方法、选择比例

### 日志文件

#### `log/` 目录
- **作用**: 存储实验日志和结果
- **结构**:
  - `*.log`: 文本格式的实验日志
  - `*.parquet`: 结构化的实验数据
  - 各种子目录存储不同实验类型的结果

### 项目配置

#### `pyproject.toml`
- **作用**: Python 项目配置文件
- **功能**:
  - 定义项目依赖（PyTorch、NumPy、Pandas等）
  - 配置 UV 包管理器
  - 设置 PyTorch 索引源（CPU/CUDA）

#### `.python-version`
- **作用**: 指定 Python 版本（3.13）

#### `uv.lock`
- **作用**: UV 包管理器的锁定文件，确保依赖版本一致性

## 使用方法

### 单个实验运行
```bash
uv run -m src.main -c conf/0.toml
```

### 批量实验运行
```bash
# 使用 Python 批量运行器
uv run batch_runner.py --batch

# 使用 Shell 脚本
./batch.sh --method ours
```

### 结果处理
```bash
uv run process_logs.py --path "log/resnet/**/*.parquet" --format markdown
```

## 主要特性

- 支持多种联邦学习攻击方法（Ascent、Lie、MinMax等）
- 灵活的配置系统，支持命令行参数覆盖
- 并行实验执行，使用 tmux 会话管理
- 完整的日志记录和结果分析工具
- 支持多种深度学习模型和数据集
- 可扩展的实验框架设计

## 依赖环境

- Python 3.13+
- PyTorch 2.7.0+
- UV 包管理器
- tmux（用于并行实验管理）